- 작성일: 2023-06-30
- 태그: 
- 분류
    - [23.05 TIL Index](23.05%20TIL%20Index.md)
- 관련 노트

---

외부 설정 주입 방법

- OS
- 자바 -D 옵션
- 커맨드 라인
- 커맨드 라인 옵션 argument
    - 스프링에서 제공하는 기능
    - 커맨드 라인으로 받은 인수를 맵 형식으로 파싱할 수 있도록 도와줌
    - 부트에서는 빈으로 제공해줌

스프링에서는 위와 같은 옵션을 한 번에 읽을 수 있도록 추상화 했음

- Environment
- 우선순위는 시스템 환경변수처럼 넓은 것 < 인수처럼 좁은 것
    - 중복 시 적용
- application.properties 라는 외부 파일을 설정파일로 읽음
    - 하지만 파일을 관리하기 어려운 단점이 있음

이 때문에 스프링에서는 내부적으로 application-XXX.properties 라는 파일을 가지고 빌드를 하도록 구성함

- 커맨드라인 옵션 인수를 통해서 프로파일을 전달하거나, 자바 옵션을 통해 프로파일을 전달하면 그에 맞는 설정 파일이 적용됨
    - 하지만 파일을 여러 개 만들어야 하는 단점이 남아 있음
    - 이를 해결하기 위해 스프링은 파일을 하나로 합치는 방법을 제공함

만약 프로필을 적용하지 않는다면

- 스프링은 default 프로필을 활성화 한다.

스프링은 설정 파일을 위에서 아래로 읽는다.

스프링 설정 우선순위

- 유연한 것이 우선순위가 높다.
    - 내장보다는 외장이 유연
- 범위가 좁은 것이 우선순위가 높다
    - 시스템 환경변수보다 자바 커맨드라인

---

스프링에서는 설정값을 불러올 수 있다. 기존에는 getProperty 를 이용해서 가져왔다. 하지만 일일이 가져오는 것은 불편하기 때문에 새로운 방법을 만들어 냈다.

@Value

- properties 의 값을 가져올 수 있다.
- 기본 값 지정이 가능하다
- 파라미터에도 지정할 수 있다.

@Value 를 통하여 일일이 지정하는 것도 불편하기 때문에 @ConfigureProperties 애노테이션을 사용한다

- @EnableConfigureProperties 를 사용하면 주입받을 수 있다.
- 이 과정이 싫다면, @ConfigurePropertiesScan 을 사용하면 자동으로 Property 를 감지하여 필요한 곳에 주입시켜 준다.

하지만 문제점이 있다.

- ConfigurationProperties 는 setter 를 이용하여 값을 등록한다.
    - 나중에 값이 바뀌는 위험성이 있다.

이를 해결하기 위해 생성자 주입 방식을 사용한다

- Setter 를 만들지 않고 생성자를 만들면, 생성자 주입 방식이 동작한다.
    - Spring 3.0 부터 생성자가 하나라면 자동으로 주입 된다.
- DefaultValue 애노테이션을 사용해 기본 값을 지정해 줄 수 있다.

남은 문제는 올바르지 않은 값이 들어왔을 때 예외 처리다.

- Validator 를 사용해서 검증할 수 있다.
    - Validated 가 붙은 클래스를 검증한다.

---

yml

- application.properties 대체로 쓰일 수 있다.
- `---` 로 프로필을 구별한다.

---

프로필 마다 빈을 따로 등록하고 싶은 경우

- @Profile 애노테이션을 이용한다.

---


System.in

- inputStream
- 1 byte 밖에 읽지 못함
    - 한글을 읽지 못함

InputStreamReader(System.in)

- 2 byte를 읽을 수 있음
    - 한글 읽을 수 있음
- 배열 크기 지정해야 함
    - 불편

BufferedReader

- `\n` 만날 때 까지 읽음
    - 배열 크기 지정 안 해도 되서 편함


