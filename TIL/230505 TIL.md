- 작성일: 2023-04-29
- 태그: 
- 분류
    - [TIL](TIL.md)
- 관련 노트

---

오늘 하루 배운 점을 정리합니다.

---

# Web Application Server

다음과 같은 특징을 가집니다.

- HTTP 기반으로 동작합니다.
- 웹 서버 기능을 포함합니다.(정적 리소스 기능 제공 가능)
- 프로그램 코드를 실행해서 애플리케이션 로직을 실행합니다.
    - 동적 HTML, HTTP API(JSON)
    - 서블릿, JSP, 스프링 MVC
- e.g.
    - 톰캣(Tomcat) JETTY, Undertow


## 멀티 쓰레드 지원

```
+-----------------+ 
| Web Application | 
| Server          | 
+-----------------+ 
|                 | 
|  +---------+    | 
|  | Thread  |    | 
|  +---------+    | 
|                 | 
|  +---------+    | 
|  | Thread  |    | 
|  +---------+    | 
|                 | 
+-----------------+ 
       ^            
       |            
       v            
+-----------------+ 
| Web Browser     | 
| (Client)        | 
+-----------------+ 
```

1. Client의 요청이 오면 가용가능한 Thread가 있는지 Thread Pool에서 확인합니다.
    - 만약 Thread를 무제한으로 만들어내면 서버가 죽을 수 있기 때문입니다.
2. 가용 가능한 Thread가 있다면 요청을 처리하고, 없다면 ready queue에서 요청을 대기 혹은 거절합니다.

### 핵심

WAS가 멀티 쓰레드를 지원함으로써 다음과 같은 장점이 있습니다.

- 개발자가 멀티 쓰레드 관련 코드를 신경 쓰지 않아도 됩니다.
    - 싱글 쓰레드 프로그래밍을 하듯 개발 가능합니다.

---
# 실무 팁

WAS의 주요 튜닝 포인트는 최대 쓰레드(max thread) 수 입니다.

따라서 다음과 같은 고려사항이 있습니다.
-   값을 너무 낮게 설정하면
    -   동시 요청이 많으면, 서버 리소스는 여유롭지만, 클라이언트는 금방 응답이 지연됩니다.
-   값을 너무 높게 설정하면
    -   동시 요청이 많으면, CPU, 메모리 리소스 임계점 초과로 서버가 다운됩니다.
-   장애 발생시
    -   클라우드면 일단 서버부터 늘리고, 이후에 튜닝해야 합니다.
    -   클라우드가 아니면 열심히 튜닝해야합니다.

Thread Pool의 최대값은 정해져 있지 않습니다. 애플리케이션 로직의 복잡도, CPU, 메모리, IO 리소스 상황 등 다양한 변수가 있습니다. 따라서 Thread Pool의 적정 숫자를 찾기 위해 아파치 ab, 제이미터, nGrinder와 같은 툴로 성능 테스트를 진행합니다.

---
# Reference

- [스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술 - 인프런 | 강의 (inflearn.com)](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1)